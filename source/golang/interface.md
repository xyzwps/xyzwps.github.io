---
title: æ¥å£
---

## æ¥å£çš„å®šä¹‰ä¸å®ç°

æ¥å£æ˜¯ä¸€ç»„æ–¹æ³•ç­¾åçš„é›†åˆã€‚ä¸€ä¸ªç±»å‹å®ç°äº†æ¥å£ï¼Œæ˜¯æŒ‡å®ƒå®ç°äº†æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚

ä¸€ä¸ªç±»å‹å®ç°æ¥å£æ˜¯éšå¼çš„ï¼Œåªéœ€è¦å®ç°æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•å³å¯ï¼Œå¹¶ä¸éœ€è¦åœ¨ç±»å‹çš„æŸä¸ªåœ°æ–¹æ ‡æ³¨å®ç°çš„æ¥å£åç§°ï¼ˆå¦‚ Java ä¸­çš„ `implement`ï¼‰ã€‚

è¿™æŠŠæ¥å£çš„å®šä¹‰å’Œå®ç°è§£è€¦äº†ï¼ˆä¹Ÿæ²¡æ³•æ–¹ä¾¿åœ°æŸ¥çœ‹å“ªäº›ç±»å‹å®ç°äº†æ­¤æ¥å£äº†ï¼‰ã€‚

```go
package main
import ("fmt"; "math")

type Abser interface {
	Abs() float64
}

func main() {
	var a Abser
	f := MyFloat(-math.Sqrt2)
	v := Vertex{3, 4}

	a = f  // MyFloat å®ç°äº† Abser
	a = &v // *Vertex å®ç°äº† Abser

	a = v // ä¸å¯ä»¥ï¼Œå› ä¸º v æ˜¯ä¸€ä¸ª Vertexï¼ˆè€Œé *Vertexï¼‰ï¼ŒVertex æ²¡æœ‰å®ç° Abser

	fmt.Println(a.Abs())
}

type MyFloat float64

func (f MyFloat) Abs() float64 {
	if f < 0 {
		return float64(-f)
	}
	return float64(f)
}

type Vertex struct {
	X, Y float64
}

func (v *Vertex) Abs() float64 {
	return math.Sqrt(v.X*v.X + v.Y*v.Y)
}
```

Go è¯­è¨€çš„æ¥å£æœ€ç¥å¥‡çš„åœ°æ–¹åœ¨äºï¼Œæˆ‘å¯ä»¥å®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å£ï¼ŒåŒæ—¶æˆ‘ä¸éœ€è¦å¯¹å·²å­˜åœ¨çš„ä»£ç åšä»»ä½•æ”¹åŠ¨ï¼Œå°±èƒ½è®©å·²å­˜åœ¨çš„ç±»å‹å®ç°è¿™ä¸ªæ¥å£ã€‚æˆ‘ç®¡è¿™å«å€’è´´å¼å®ç°ğŸ˜

## æ¥å£å€¼

åœ¨åº•å±‚ï¼Œæ¥å£çš„å€¼æ˜¯ä¸€ä¸ªå€¼å’Œå…·ä½“ç±»å‹çš„äºŒå…ƒç»„â€”â€”`(value, type)`ã€‚æ¥å£å€¼æŒæœ‰ä¸€ä¸ªåº•å±‚ç±»å‹çš„å€¼ã€‚
æ¥å£å€¼è°ƒç”¨æ–¹æ³•ï¼Œæ˜¯ä½¿ç”¨åº•å±‚çš„å€¼è°ƒç”¨åº•å±‚ç±»å‹çš„æ–¹æ³•ã€‚

```go
package main

import ( "fmt"; "math" )

type I interface {
	M()
}

type T struct {
	S string
}

func (t *T) M() {
	fmt.Println(t.S)
}

type F float64

func (f F) M() {
	fmt.Println(f)
}

func main() {
	var i I

	i = &T{"Hello"}
	describe(i) // è¾“å‡º (&{Hello}, *main.T)
	i.M() // è¾“å‡º Hello

	i = F(math.Pi)
	describe(i) // è¾“å‡º (3.141592653589793, main.F)
	i.M() // è¾“å‡º 3.141592653589793
}

func describe(i I) {
	fmt.Printf("(%v, %T)\n", i, i)
}
```

å¦‚æœæ¥å£å€¼å†…éƒ¨çš„å€¼æ˜¯ä¸€ä¸ª `nil`ï¼Œä½†æ˜¯æœ‰åº•å±‚ç±»å‹ï¼Œé‚£ä¹ˆæ¥å£å€¼è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šå¾€æ–¹æ³•çš„æ¥å—å‚æ•°ä¸­ä¼ å…¥ä¸€ä¸ª `nil`ã€‚åœ¨åˆ«çš„è¯­è¨€ä¸­ï¼Œè¿™ä¼šæŠ›å‡ºä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†æ˜¯ Go ä¸­ä¸ä¼šï¼Œå› ä¸ºæ–¹æ³•å°±æ˜¯å‡½æ•°ã€‚

## æ¥å£é›¶å€¼

æ¥å£é›¶å€¼æ—¢æ²¡æœ‰å€¼ï¼Œåˆæ²¡æœ‰å…·ä½“ç±»å‹ã€‚ç”¨æ¥å£é›¶å€¼è°ƒç”¨æ–¹æ³•ï¼Œä¼šè·‘å‡ºä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ï¼Œå› ä¸ºæ²¡æœ‰å…·ä½“ç±»å‹ç»‘å®šï¼Œæ‰€ä»¥æ²¡æœ‰å‡½æ•°å¯ä»¥è°ƒç”¨ã€‚æ¯”å¦‚ï¼š

```go
package main
import "fmt"

type I interface {
	M()
}

func main() {
	var i I
	describe(i) // è¾“å‡º (<nil>, <nil>)
	i.M() // panic: runtime error, balabalabala
}

func describe(i I) {
	fmt.Printf("(%v, %T)\n", i, i)
}
```

## ç©ºæ¥å£

ç©ºæ¥å£æ²¡æœ‰ä»»ä½•æ–¹æ³•å£°æ˜ã€‚å°±åƒä¸‹é¢é‚£æ ·ï¼š

```go
interface {}
```

ç©ºæ¥å£å¯ä»¥æŒæœ‰ä»»ä½•ç±»å‹çš„å€¼ï¼ˆå› ä¸ºæ¯ä¸ªç±»å‹è‡³å°‘å®ç°äº† 0 ä¸ªæ–¹æ³•ï¼‰ã€‚ç©ºæ¥å£é€šå¸¸ç”¨æ¥å¤„ç†ç±»å‹æœªçŸ¥çš„å€¼ï¼Œæ¯”å¦‚ `fmt.Print` æ¥å—ä»»ä½•æ•°é‡çš„ `interface{}` å‚æ•°ã€‚

```go
package main
import "fmt"

func main() {
	var i interface{}
	describe(i) // (<nil>, <nil>)

	i = 42
	describe(i) // (42, int)

	i = "hello"
	describe(i) // (hello, string)
}

func describe(i interface{}) {
	fmt.Printf("(%v, %T)\n", i, i)
}
```

åœ¨æ ‡å‡†åº“çš„ `log` åŒ…é‡Œï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªåˆ«åï¼š

```go
type any = interface{}
```

## ç±»å‹æ–­è¨€

ç±»å‹æ–­è¨€æä¾›ä¸€ç§æ–¹å¼æ¥è®¿é—®æ¥å£åº•å±‚ valueã€‚

```go
t := i.(T)
```

ä¸Šé¢çš„è¯­å¥ï¼Œæ–­è¨€æ¥å£å€¼ `i` æŒæœ‰ä¸€ä¸ª `T` ç±»å‹çš„åº•å±‚å€¼ï¼Œå¹¶æŠŠè¿™ä¸ªåº•å±‚å€¼èµ‹å€¼ç»™ `t`ã€‚å¦‚æœ `i` ä¸å«æœ‰ `T` ç±»å‹çš„å€¼ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘ä¸€ä¸ª panicã€‚

ä¸ºäº†æ£€æµ‹æ¥å£å€¼æ˜¯å¦æŒæœ‰å…·ä½“ç±»å‹ï¼Œæ¥å£æ–­è¨€å¯ä»¥è¿”å›ä¸¤ä¸ªå€¼ï¼šåº•å±‚å€¼å’Œæ–­è¨€æ˜¯å¦æ­£ç¡®ï¼š

```go
t, ok = i.(T)
```

å¦‚æœ `i` æŒæœ‰ `T` ç±»å‹çš„åº•å±‚å€¼ï¼Œé‚£ä¹ˆ `ok == true` ä¸” `t` è¢«èµ‹å€¼ä¸ºæ¥å£åº•å±‚å€¼ï¼›å¦åˆ™ï¼Œ`ok == false`ï¼Œ`t` è¢«èµ‹å€¼ä¸ºç±»å‹ `T` çš„é›¶å€¼ï¼Œä¸ä¼šè§¦å‘ panicã€‚

```go
package main

import "fmt"

func main() {
	var i interface{} = "hello"

	s := i.(string)
	fmt.Println(s) // è¾“å‡º hello

	s, ok := i.(string)
	fmt.Println(s, ok) // è¾“å‡º hello true

	f, ok := i.(float64)
	fmt.Println(f, ok) // è¾“å‡º 0 false

	f = i.(float64) // panic
	fmt.Println(f)
}
```

## ç±»å‹ switch

ç±»å‹ switch å…è®¸è¿›è¡Œä¸€ç³»åˆ—ç±»å‹æ–­è¨€ã€‚ç±»å‹ switch å’Œæ™®é€š switch ç±»ä¼¼ï¼Œä½†æ˜¯ case åé¢è·Ÿçš„æ˜¯ç±»å‹åç§°ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å€¼ï¼š

```go
switch v := i.(type) { // æ³¨æ„è¿™é‡Œæ‹¬å·ä¸­æ˜¯å…³é”®å­— type
case T:
    // v æ˜¯ T ç±»å‹çš„
case S:
    // v æ˜¯ S ç±»å‹çš„
default:
    // æ²¡åŒ¹é…ï¼Œv å’Œ i æ˜¯ç»Ÿä¸€ç±»å‹
}
```

## å¸¸ç”¨æ¥å£

### Stringer

`Stringer` æ˜¯ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„æ¥å£ï¼Œè¢«å®šä¹‰åœ¨ `fmt` åŒ…ä¸­ï¼š

```go
type Stringer interface {
    String() string
}
```

`Stringer` ç”¨äºè¾“å‡ºä¸€ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²æè¿°ï¼ˆç±»ä¼¼äº Java çš„ `toString`ï¼‰ï¼Œ`fmt` åŒ…ç”¨è¿™ä¸ªæ¥å£æ¥æ‰“å°å€¼ã€‚

### Error

Go è¯­è¨€ç”¨ `error` å€¼æ¥è¡¨è¾¾é”™è¯¯çŠ¶æ€ã€‚`error` æ¥å£æ˜¯ä¸€ä¸ªå…§å»ºæ¥å£ï¼Œå¤§çº¦é•¿ä¸‹é¢è¿™æ ·ï¼š

```go
type error interface {
    Error() string
}
```

å‡½æ•°ç»å¸¸ä¼šè¿”å›ä¸€ä¸ª `error` å€¼ï¼Œè°ƒç”¨ä»£ç éœ€è¦å¯¹æ­¤åšæ£€æŸ¥ï¼Œå¦‚æœé `nil`ï¼Œå°±è¦å¤„ç†é”™è¯¯ï¼š

```go
i, err := strconv.Atoi("42")
if err != nil {
    fmt.Printf("couldn't convert number: %v\n", err)
    return
}
fmt.Println("Converted integer:", i)
```

`error` å€¼ä¸º `nil` è¡¨ç¤ºæˆåŠŸï¼Œå¦åˆ™è¡¨ç¤ºå¤±è´¥ã€‚

### io.Reader

åœ¨ `io` åŒ…ä¸­ï¼Œæœ‰ä¸€ä¸ªå« `io.Reader` çš„æ¥å£ï¼Œè¡¨ç¤ºè¯»åˆ°ä¸€ä¸ªæµæ•°æ®çš„æœ«å°¾ã€‚Go è¯­è¨€æœ‰å¾ˆå¤šæ ‡å‡†åº“å®ç°äº†æ­¤æ¥å£ï¼Œæ¯”å¦‚æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ã€å‹ç¼©ã€å¯†ç ç­‰ç­‰ç­‰ç­‰ã€‚æ­¤æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼š

```go
func (T) Read(b []byte) (n int, err error)
```

è¿™ä¸ªæ–¹æ³•æŠŠæ•°æ®ä¸­çš„å­—èŠ‚è¯»åˆ°ä¸€ä¸ªåˆ‡ç‰‡ä¸­ï¼Œå¹¶è¿”å›è¯»åˆ°çš„å­—èŠ‚æ•°å’Œä¸€ä¸ªé”™è¯¯ã€‚å¦‚æœåˆ°äº†æµçš„æœ«å°¾ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ª `io.EOF` é”™è¯¯ã€‚