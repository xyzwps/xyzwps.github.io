---
title: æ³›å‹
comments: false
---

Go 1.18 ç‰ˆæœ¬å¼•å…¥æ³›å‹ï¼Œè€Œä¸”æ˜¯æ¯”è¾ƒç®€å•çš„é‚£ç§ã€‚

# æ³›å‹å‡½æ•°

ä¸‹é¢æœ‰ä¸¤ä¸ªå‡½æ•°ï¼š

```go
func SumInt(a, b int) int {
	return a + b
}

func SumFloat32(a, b float32) float32 {
	return a + b
}
```

åœ¨æ²¡æœ‰æ³›å‹ä¹‹å‰ï¼Œè¿™æ ·çš„ä¸œè¥¿å°±åªèƒ½ç¡¬å†™ã€‚æœ‰äº†æ³›å‹ä¹‹åï¼Œå°±å¯ä»¥å†™æˆè¿™æ ·ï¼š

```go
func Sum[T int | float32](a, b T) T {
	return a + b
}
```

æ³¨æ„ï¼Œå‡½æ•°å `Sum` åé¢çš„æ–¹æ‹¬å·ä¸­ `T` æ˜¯æ³›å‹å‚æ•°ï¼Œå®ƒçš„å–å€¼å¯ä»¥æ˜¯ `int` æˆ–è€… `float32`ã€‚ä½¿ç”¨ä¸Šä¹Ÿå¾ˆç®€å•ï¼š

```go
println(Sum[int](1, 2))
println(Sum[float32](1.2, 2.3))
```

å› ä¸º 1 å’Œ 2 æ˜¯ `int` å­—é¢é‡ï¼Œæ‰€ä»¥ `Sum[int](1, 2)` ä¸­çš„ç±»å‹å‚æ•°å¯ä»¥å»æ‰ï¼Œç®€å†™ä¸º `Sum(1, 2)`ï¼›å› ä¸º 1.2 å’Œ 2.3 æ˜¯ `float64` å­—é¢é‡ï¼Œæ‰€ä»¥ `Sum[float32](1.2, 2.3)` å°±ä¸èƒ½æŠŠç±»å‹å‚æ•°å»æ‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè§‚å¯Ÿ IDE çš„åªèƒ½æç¤ºæ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥å»æ‰ç±»å‹å‚æ•°ğŸ˜ã€‚

# æ³›å‹ struct

å°±åƒå‡½æ•°çš„æ³›å‹å‚æ•°åˆ—è¡¨è¦å†™åˆ°å‡½æ•°ååé¢é‚£æ ·ï¼Œstruct çš„æ³›å‹å‚æ•°åˆ—è¡¨è¦å†™åˆ° struct åç§°åé¢ï¼Œæ¯”å¦‚ï¼š

```go
type Pair[A any, B any] struct {
	First  A
	Second B
}
```

åœ¨ä½¿ç”¨æ—¶ï¼Œç±»å‹åˆ—è¡¨ä¹Ÿæ˜¯è¦æ”¾åˆ° struct åç§°åé¢ï¼š

```go
println(Pair[int, string]{First: 1, Second: "12"})
```

# ç±»å‹çº¦æŸ

ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œæ³›å‹å‚æ•°åˆ—è¡¨è¦æ”¾åˆ°å‡½æ•°æˆ–è€… struct çš„åç§°åé¢ï¼Œç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥ï¼›å¤šä¸ªå‚æ•°ç”¨é€—å·åˆ†éš”ã€‚æ³›å‹å‚æ•°ååé¢æ˜¯ç±»å‹çº¦æŸã€‚

ç±»å‹çº¦æŸä¸€èˆ¬æœ‰è¿™ä¹ˆå‡ ç§ï¼š

* ç±»å‹å…ƒç´ çº¦æŸï¼Œå³ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹çš„è”åˆã€‚å¦‚æœæœ‰å¤šä¸ªç±»å‹çš„è¯ï¼Œç”¨ `|` æŠŠå®ƒä»¬åˆ†å‰²å¼€ã€‚æ¯”å¦‚ `[T int | float32 | float64]` è¡¨ç¤º `T` å¯ä»¥æ˜¯ `int`ã€`float32`ã€`float64`ï¼Œä½†ä¸å¯ä»¥æ˜¯åˆ«çš„ã€‚
* åº•å±‚ç±»å‹çº¦æŸï¼Œå³æ¥å—åº•å±‚ç±»å‹ä¸ºæŸä¸ªæŒ‡å®šç±»å‹çš„å‚æ•°ï¼Œç”¨ `~` æ ‡åœ¨åº•å±‚ç±»å‹å‰æ–¹ã€‚æ¯”å¦‚ `[T ~int]` è¡¨ç¤º `T` çš„åº•å±‚ç±»å‹å¿…é¡»æ˜¯ `int`ã€‚
* `comparable` æ˜¯ä¸€ä¸ª interfaceï¼Œæ‰€æœ‰çš„å¯æ¯”è¾ƒç±»å‹éƒ½å®ç°äº†å®ƒã€‚è¿™äº›å¯æ¯”è¾ƒç±»å‹æœ‰ï¼šå¸ƒå°”ç±»å‹ã€æ•°å­—ç±»å‹ã€å­—ç¬¦ä¸²ã€æŒ‡é’ˆã€channelã€å¯æ¯”è¾ƒç±»å‹æ•°ç»„ï¼Œä»¥åŠæ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯æ¯”è¾ƒç±»å‹çš„ structã€‚è¿™ä¸ªæ¥å£ä»…ç”¨äºç±»å‹çº¦æŸã€‚æ¯”å¦‚ `[T comparable]`ã€‚
* `any`ã€‚

ä¸Šé¢å†™çš„æ³›å‹çº¦æŸéƒ½æ˜¯ä¸€ç§ç®€å†™çš„æ–¹å¼ã€‚æ¯”å¦‚ï¼š

```go
[T []P]         // = [T interface{[]P}]
[T ~int]        // = [T interface{~int}]
[T int|string]  // = [T interface{int|string}]
```

æ³›å‹å‚æ•°åˆ—è¡¨é‡Œçš„ç±»å‹å¯ä»¥ç›¸äº’ä¾èµ–ã€‚æ¯”å¦‚ä¸‹ä¾‹ä¸­ç±»å‹ `T` å°±ä¾èµ–äºç±»å‹ `F`ï¼š

```go
func List1[T []F, F int | float32 | string](i F) T {
	result := make(T, 1)
	result[0] = i
	return result
}
```

# ç¤ºä¾‹

æœ‰äº†æ³›å‹ä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½å¿«ä¹åœ°åšä¸€äº›ä»¥å‰åšä¸åˆ°çš„äº‹æƒ…äº†ã€‚æ¯”å¦‚å†™ä¸€ä¸ª reduce å‡½æ•°ï¼š

```go
func Reduce[T any, R any](list []T, reducer func(T, R) R, init R) (result R) {
	result = init
	for _, it := range list {
		result = reducer(it, result)
	}
	return
}
```

æ¯”å¦‚å†™ä¸€ä¸ª map å‡½æ•°:

```go
func Map[F any, T any](from []F, mapper func(F) T) []T {
	to := make([]T, len(from))
	for i, it := range from {
		to[i] = mapper(it)
	}
	return to
}
```

# æ³›å‹åº“

ç½‘ä¸Šåº”è¯¥ä¹Ÿæœ‰äººå†™äº†ä¸€äº›å¤„ç†é›†åˆçš„ä¸€äº›åº“ï¼Œæ¯”å¦‚ [samber/lo](https://github.com/samber/lo)ã€‚å¯ä»¥ç¼–ç¨‹è¿‡ç¨‹ä¸­çš„ç—›è‹¦å°‘äº†ä¸€å¤§åŠ~

# å¸¸è§é—®é¢˜

## å¦‚ä½•è¿”å› T ç±»å‹çš„é›¶å€¼

æ¯”å¦‚æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•°:

```go
func A[T any]() (T, error) {
	if result, err := doSomething(); err != nil {
		return ${Tçš„é›¶å€¼}, err
	} else {
		return result, nil
	}
}
```

`${}` éƒ¨åˆ†åº”è¯¥å†™ä»€ä¹ˆï¼Ÿå¦‚æœå†™ `nil` ä¼šäº§ç”Ÿä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚Go ä¸­ä¹Ÿæ²¡æœ‰ç±»ä¼¼ C# ä¸­çš„é»˜è®¤å€¼è¡¨è¾¾å¼ã€‚è¯¥æ€ä¹ˆåŠï¼Ÿè¿™é‡Œåªèƒ½ç»•ä¸€ä¸‹äº†ï¼Œæ¯”å¦‚å†™æˆä¸‹é¢è¿™æ ·ï¼š

```go
func A[T any]() (T, error) {
	if result, err := doSomething(); err != nil {
		var zeroValue T  // è¿™é‡Œå£°æ˜ä¸€ä¸ª T ç±»å‹çš„å˜é‡
		return zeroValue, err
	} else {
		return result, nil
	}
}
```


# å‚è€ƒ

- [The Go Programming Language Specification](https://go.dev/ref/spec)