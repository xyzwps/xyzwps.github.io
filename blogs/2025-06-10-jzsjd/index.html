<!DOCTYPE html><html lang="zh-CN"> <head><link rel="canonical" href="/blogs/2025-06-10-jzsjd"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>集中时间段</title><script>
  var _hmt = _hmt || [];
  (function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e5cd13f29c2fc3a6a3ca36ad30480374";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script><link href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.4/katex.min.css" rel="stylesheet"><link rel="stylesheet" href="/_astro/2024-08-27-dg-to-di.By4DU7xU.css"></head> <body class="bg-indigo-50 pb-6"> <div class="container mx-auto px-4 py-2 flex"> <a href="/" class="rounded-full bg-white py-2 px-6 select-none"><span class="font-bold">@xyzwps</span></a> </div> <div class="container mx-auto pt-4 px-4 sm:px-6 lg:px-8"> <nav class="flex" aria-label="Breadcrumb"> <ol class="inline-flex items-center space-x-1 md:space-x-3"> <li class="inline-flex items-center"> <a href="/" class="inline-flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors duration-200"> <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"> <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path> </svg>
主页
</a> </li> <li> <div class="flex items-center"> <svg class="w-6 h-6 text-indigo-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"> <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path> </svg> <a href="/blogs" class="ml-1 text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors duration-200 md:ml-2"> 文章列表 </a> </div> </li> </ol> </nav> </div> <div class="container mx-auto p-4 min-h-screen"> <div class="grid grid-cols-4 gap-4"> <div class="prose prose-slate prose-code:before:content-[''] prose-code:after:content-[''] prose-img:p-4 prose-img:shadow  bg-white max-w-none col-span-3 max-lg:col-span-4 border border-indigo-50 rounded-lg p-6 shadow"> <h1>集中时间段</h1> <div class="text-sm text-gray-400">2025-06-10</div>   <h2 id="背景">背景</h2>
<p>事情是这样的。</p>
<p>我司最近要做一个定时报告功能，其中有一项是计算出一天 24 小时内，哪些时间段内出现告警的次数比较集中。
举个例子，下面是一天中从 0 点到 23 点，每小时出现的告警次数列表：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ABB2BF">[</span><span style="color:#D19A66">25</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">]</span></span></code></pre>
<p>画成柱状图如下:</p>
<p><img src="/assets/img/blogs/jzsjd1.png" alt="告警柱状图"/></p>
<p>观察柱状图，我们可以随口一说</p>
<ul>
<li>告警集中在 0 点到 17 点这段时间内（可是这都占一天时间的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>3</mn><mn>4</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\cfrac{3}{4}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.74em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span></span></span></span></span></span> 了，集中个 P!）</li>
<li>告警集中在 0 点到 8 点这段时间内（好像说得过去？）</li>
<li>告警集中在 0 点到 1 点和 4 点到 8 点这两个时间段内（你觉得符合直觉吗？）</li>
</ul>
<p>可以看到，具体怎么样才算集中，是相当主观的。</p>
<p>我想着，我应该不是第一个遇到这个问题的人，应该有现成的算法来搞这个东西。
于是问了下 deepseek，结果非常不满意。</p>
<p>想着现在可是 AI 新纪元了，这种事情就交给 AI 来搞好了！</p>
<h2 id="ai-版算法">AI 版算法</h2>
<p>于是我写了个 prompt 让 AI 帮我来搞。如下：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="md"><code><span class="line"><span style="color:#ABB2BF">你是一个高可用时间集中度分析器。请严格按以下步骤处理输入数据，最终输出必须是符合指定 JSON schema 的纯 JSON 对象，不要包含任何额外文本、解释或格式符号。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">### 输入数据格式</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">-</span><span style="color:#ABB2BF"> 24小时（0-23点）每个小时的告警数量数组，例如：</span><span style="color:#E5C07B">`</span><span style="color:#98C379">[5,0,3,...,12]</span><span style="color:#E5C07B">`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">### 集中时段判定规则</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">1.</span><span style="color:#D19A66"> **连续时段**</span><span style="color:#ABB2BF">：仅考虑连续小时（时段长度≤4小时）</span></span>
<span class="line"><span style="color:#E5C07B">2.</span><span style="color:#D19A66"> **总量阈值**</span><span style="color:#ABB2BF">：时段内告警总数 ≥ 全天告警总量的 40%</span></span>
<span class="line"><span style="color:#E5C07B">3.</span><span style="color:#D19A66"> **数量限制**</span><span style="color:#ABB2BF">：最多 3 个时段，且时段不可重叠。如果两个时段是连续的，应当合并在一起。</span></span>
<span class="line"><span style="color:#E5C07B">4.</span><span style="color:#D19A66"> **均匀分布时**</span><span style="color:#ABB2BF">：若无符合条件时段，输出空数组</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">### 输出要求</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">-</span><span style="color:#ABB2BF"> 仅输出 JSON 对象，必须符合此 schema：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">```json</span></span>
<span class="line"><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75">  &quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;object&quot;</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  &quot;properties&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75">    &quot;timeSpans&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75">      &quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;array&quot;</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">      &quot;items&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75">        &quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;object&quot;</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">        &quot;properties&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75">          &quot;start&quot;</span><span style="color:#ABB2BF">: { </span><span style="color:#E06C75">&quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;integer&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;description&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;从几点（包含）开始&quot;</span><span style="color:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75">          &quot;end&quot;</span><span style="color:#ABB2BF">: { </span><span style="color:#E06C75">&quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;integer&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;description&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;从几点（包含）结束。start 可以等于 end，表示集中于一个小时&quot;</span><span style="color:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75">          &quot;count&quot;</span><span style="color:#ABB2BF">: { </span><span style="color:#E06C75">&quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;integer&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;description&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;表示这个时间段内的数量&quot;</span><span style="color:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#E06C75">        &quot;required&quot;</span><span style="color:#ABB2BF">: [</span><span style="color:#98C379">&quot;start&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;end&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;count&quot;</span><span style="color:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75">        &quot;additionalProperties&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">false</span></span>
<span class="line"><span style="color:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF">`` `</span></span>
<span class="line"><span style="color:#ABB2BF">- 示例输出：`{</span><span style="color:#E06C75">&quot;timeSpans&quot;</span><span style="color:#ABB2BF">: [{</span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">9</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">11</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">35</span><span style="color:#ABB2BF"> }, </span><span style="color:#FFFFFF">...</span><span style="color:#ABB2BF">]}`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">### 处理流程</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D19A66">1</span><span style="color:#ABB2BF">. 计算全天告警总量 `totalAlerts`</span></span>
<span class="line"><span style="color:#D19A66">2</span><span style="color:#ABB2BF">. 扫描所有连续时段（长度 </span><span style="color:#D19A66">1-4</span><span style="color:#ABB2BF"> 小时），计算时段内告警和 `sum`</span></span>
<span class="line"><span style="color:#D19A66">3</span><span style="color:#ABB2BF">. 若 `sum ≥ totalAlerts × </span><span style="color:#D19A66">0.4</span><span style="color:#ABB2BF">` 则标记为候选时段</span></span>
<span class="line"><span style="color:#D19A66">4</span><span style="color:#ABB2BF">. 按 `sum` 降序选取至多 </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF"> 个非重叠时段</span></span>
<span class="line"><span style="color:#ABB2BF">    - 连续合并: 如果两个区间是连续的，应当合并。比如有两个区间 {</span><span style="color:#E06C75">&quot;timeSpans&quot;</span><span style="color:#ABB2BF">: [{</span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">18</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">28</span><span style="color:#ABB2BF">},{</span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">19</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">19</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">}]}, 应当被合并为 {</span><span style="color:#E06C75">&quot;timeSpans&quot;</span><span style="color:#ABB2BF">: [{</span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">19</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">33</span><span style="color:#ABB2BF">}]}</span></span>
<span class="line"><span style="color:#D19A66">5</span><span style="color:#ABB2BF">. 若无合格时段，输出 `{</span><span style="color:#E06C75">&quot;timeSpans&quot;</span><span style="color:#ABB2BF">: []}`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">### 参考样例</span><span style="color:#D19A66">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">-&gt; 输入:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">8</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">9</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">12</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">11</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">14</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">12</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">16</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">13</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">14</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">15</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">16</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">18</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">18</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">20</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">19</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">20</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">21</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">22</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">23</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">&lt;- 输出</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">: { </span><span style="color:#E06C75">&quot;timeSpans&quot;</span><span style="color:#ABB2BF">: [{ </span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">8</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">13</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">53</span><span style="color:#ABB2BF"> }, { </span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">15</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">18</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">52</span><span style="color:#ABB2BF"> }]}</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;- 输出</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">: { </span><span style="color:#E06C75">&quot;timeSpans&quot;</span><span style="color:#ABB2BF">: [{ </span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">9</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">12</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">53</span><span style="color:#ABB2BF"> }, { </span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">16</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">18</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">48</span><span style="color:#ABB2BF"> }]}</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;- 输出</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">: { </span><span style="color:#E06C75">&quot;timeSpans&quot;</span><span style="color:#ABB2BF">: [{ </span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">9</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">12</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">53</span><span style="color:#ABB2BF"> }, { </span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">16</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">28</span><span style="color:#ABB2BF"> }, { </span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">18</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">18</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">20</span><span style="color:#ABB2BF"> }]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">其中只有输出</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">是合格的:</span></span>
<span class="line"><span style="color:#ABB2BF">- 输出</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">不合格, 因为区间</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">是[</span><span style="color:#D19A66">8</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">13</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">8</span><span style="color:#ABB2BF"> 点只有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个, </span><span style="color:#D19A66">13</span><span style="color:#ABB2BF"> 点只有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个, 在集中区间里占比过分低了;</span></span>
<span class="line"><span style="color:#ABB2BF">- 输出</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">合格, 因为区间[</span><span style="color:#D19A66">9</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">12</span><span style="color:#ABB2BF">], 这</span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">个小时的数量显著比周围高, 区间[</span><span style="color:#D19A66">16</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">18</span><span style="color:#ABB2BF">] 也显著比周围高;</span></span>
<span class="line"><span style="color:#ABB2BF">- 输出</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">不合格, 因为区间[</span><span style="color:#D19A66">16</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">]和[</span><span style="color:#D19A66">18</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">18</span><span style="color:#ABB2BF">]是连续的，应当合并为[</span><span style="color:#D19A66">16</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">18</span><span style="color:#ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">### 参考样例</span><span style="color:#D19A66">2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">-&gt; 输入:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">昨天的告警数量是：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">8</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">9</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">11</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">12</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">13</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">14</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">15</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">16</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">18</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">19</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">20</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">21</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">22</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"><span style="color:#ABB2BF">- </span><span style="color:#D19A66">23</span><span style="color:#ABB2BF"> 点有 </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> 个</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">&lt;- 输出</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">: {</span><span style="color:#E06C75">&quot;timeSpans&quot;</span><span style="color:#ABB2BF">: [{</span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">}, {</span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">13</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">14</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">}]}</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;- 输出</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">: {</span><span style="color:#E06C75">&quot;timeSpans&quot;</span><span style="color:#ABB2BF">: [{</span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">}, {</span><span style="color:#E06C75">&quot;start&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">9</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;end&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">14</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">&quot;count&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">}]}</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;- 输出</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">: {</span><span style="color:#E06C75">&quot;timeSpans&quot;</span><span style="color:#ABB2BF">: []}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">其中只有输出</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">是合格的: 从数据中可以看到 </span><span style="color:#D19A66">24</span><span style="color:#ABB2BF"> 小时中大部分都有数据, 但是大部分数据变化都比较平缓（所有数据取值都在 </span><span style="color:#D19A66">0-3</span><span style="color:#ABB2BF"> 之间），所以没有集中趋势。</span></span></code></pre>
<p>于是我得到了一个计算集中时段的“算法”。</p>
<p>从 prompt 内容可以看出，AI “计算”这种东西的时候，总是出一些问题：</p>
<ul>
<li>输出不稳定，同样的输入，经常会得到不一样的输出。</li>
<li>AI 给出的集中时间段区间，可能包含两个紧挨在一起的区间，AI 又不会主动去合并。</li>
</ul>
<p>现在这个情况不慎理想，是因为使用的是基础模型。除了上面两个比较严重的问题之外，还有些其他细微问题就不啰嗦了。
现在一次计算用时在 10s 左右。如果使用推理模型，一次“计算”的用时基本要 1 分钟以上。一个报告里要计算 5-8
次，这个时间消耗有点让人无法接受。</p>
<p>我就想有没有别的办法，但是连续几周，我都没有头绪，先用基础模型凑合吧。</p>
<h2 id="手算版算法">手算版算法</h2>
<p>前几天突然想到一个办法。</p>
<h3 id="思路">思路</h3>
<p>是这样的：</p>
<blockquote>
<p>每次都选取序列中最大的值，把它合并到附近“区间”中。如果附近没有区间，就让最大值单独成为区间。</p>
</blockquote>
<p>下面是一个模拟的计算过程：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#7F848E;font-style:italic">// 初态</span></span>
<span class="line"><span style="color:#ABB2BF">[</span><span style="color:#D19A66">25</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// 选取最大值 25，它周围没有区间，所以单独成区间</span></span>
<span class="line"><span style="color:#ABB2BF">[[</span><span style="color:#D19A66">25</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// 选取最大值 17，它周围没有区间，所以单独成区间</span></span>
<span class="line"><span style="color:#ABB2BF">[[</span><span style="color:#D19A66">25</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// 选取最大值 10，它周围有区间就加入，没区间就单独成为区间</span></span>
<span class="line"><span style="color:#ABB2BF">[[</span><span style="color:#D19A66">25</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// 选取最大值 7，它周围有区间就加入，没区间就单独成为区间</span></span>
<span class="line"><span style="color:#ABB2BF">[[</span><span style="color:#D19A66">25</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// 选取最大值 6，它周围有区间就加入，没区间就单独成为区间</span></span>
<span class="line"><span style="color:#ABB2BF">[[</span><span style="color:#D19A66">25</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// 重复上面的过程</span></span></code></pre>
<p>重复上面的步骤，我们可以把整个列表都合并成一个区间（😱）。这并不是我们想要的结果，
所以需要选择一个合适的时机，让计算停止，避免把所有的数字都加入区间。
我想到了用中位数作为停止条件：对所有大于（不包含等于）中位数的数字重复执行上面的步骤。</p>
<p>对于上面的例子，中位数是 5，所以我们计算完 6 之后就停止，得到：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ABB2BF">[[</span><span style="color:#D19A66">25</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">5</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, [</span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">]</span></span></code></pre>
<p>我们把其中的区间留下，得到</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ABB2BF">[[</span><span style="color:#D19A66">25</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], [</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">17</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">], [</span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">], [</span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">], [</span><span style="color:#D19A66">7</span><span style="color:#ABB2BF">]]</span></span></code></pre>
<p>现在我们有几个选择：</p>
<ul>
<li>取区间总和最大的前几个（比如前 2 个）</li>
<li>取区间总和占一天中的百分比大于某个阈值的几个（比如 20%）（我选的是这个，效果尚可）</li>
<li>甚至可以综合区间的长度来筛选</li>
</ul>
<p>可以看到，我们得到了几个区间，这些区间内的告警数量，占一天中总的告警数量比重较大；
而它们的总长度不会超过半天。区间长度短、占比重又较大，算是“集中”吧。</p>
<p>这样的算法对变化平缓的数据，也是适用的，如果数据整体波动不大，或者没有明显的集中趋势，会得不到任何集中区间。比如：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ABB2BF">[</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">]</span></span></code></pre>
<p>的中位数是 2.5。经过两轮集中后，我们得到这样一些区间：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ABB2BF">[[</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">], [</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">], [</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">], [</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">], [</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">], [</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">]]</span></span></code></pre>
<p>这些区间占整体的比例过低，都被排除掉了。</p>
<p>这个算法并不算完美，比如：</p>
<ul>
<li>是否有比中位数更适合作为停止条件的数值？</li>
<li>区间集中的过程停止后，是否有更好的选取区间的方法？</li>
</ul>
<p>我不知道。从我写了几十个测试用例后发现，选取中位数，然后选取区间占总体比例超过 20% 的区间，效果还行。</p>
<p>下面是我写的一个 Java 版</p>
<h3 id="代码">代码</h3>
<p>，没有做优化，不过也差不多了：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> java.util.ArrayList</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> java.util.Comparator</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> java.util.LinkedList</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#E5C07B"> java.util.List</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> final</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> DenseSpans</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> static</span><span style="color:#ABB2BF"> &lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#61AFEF"> value</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">double</span><span style="color:#E06C75;font-style:italic"> value</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">E</span><span style="color:#E06C75;font-style:italic"> extra</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#ABB2BF">&lt;&gt;(value, extra);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> sealed</span><span style="color:#C678DD"> interface</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        final</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> Value</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#C678DD"> implements</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#61AFEF"> Value</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">double</span><span style="color:#E06C75;font-style:italic"> value</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">E</span><span style="color:#E06C75;font-style:italic"> extra</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">                this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">value</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> value;</span></span>
<span class="line"><span style="color:#E5C07B">                this</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">extra</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> extra;</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> double</span><span style="color:#E06C75"> value</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> E</span><span style="color:#E06C75"> extra</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> double</span><span style="color:#61AFEF"> value</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> { </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> value; }</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#E5C07B"> E</span><span style="color:#61AFEF"> extra</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> { </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> extra; }</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">        record</span><span style="color:#E5C07B"> Range</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">LinkedList</span><span style="color:#56B6C2">&lt;</span><span style="color:#E5C07B">Value</span><span style="color:#56B6C2">&lt;</span><span style="color:#E06C75">E</span><span style="color:#56B6C2">&gt;&gt;</span><span style="color:#E06C75"> values</span><span style="color:#ABB2BF">,</span><span style="color:#C678DD"> double</span><span style="color:#E06C75"> sum) </span><span style="color:#C678DD">implements</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#E5C07B"> Value</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#61AFEF"> first</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> { </span><span style="color:#C678DD">return</span><span style="color:#E5C07B"> values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getFirst</span><span style="color:#ABB2BF">(); }</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#E5C07B"> Value</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#61AFEF"> last</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF">  { </span><span style="color:#C678DD">return</span><span style="color:#E5C07B"> values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getLast</span><span style="color:#ABB2BF">();  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#E5C07B"> String</span><span style="color:#61AFEF"> rangeStr</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isEmpty</span><span style="color:#ABB2BF">()) {</span></span>
<span class="line"><span style="color:#C678DD">                    return</span><span style="color:#98C379"> &quot;&quot;</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">size</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">==</span><span style="color:#D19A66"> 1</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD">                    return</span><span style="color:#E5C07B"> values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getFirst</span><span style="color:#ABB2BF">().</span><span style="color:#E5C07B">extra</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">toString</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#C678DD">                return</span><span style="color:#E5C07B"> String</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">format</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;%s-%s&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getFirst</span><span style="color:#ABB2BF">().</span><span style="color:#E5C07B">extra</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getLast</span><span style="color:#ABB2BF">().</span><span style="color:#E5C07B">extra</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> static</span><span style="color:#ABB2BF"> &lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E5C07B"> List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Range</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt;</span><span style="color:#61AFEF"> merge</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt; </span><span style="color:#E06C75;font-style:italic">values</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#61AFEF"> merge</span><span style="color:#ABB2BF">(values, </span><span style="color:#D19A66">0.2</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> static</span><span style="color:#ABB2BF"> &lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E5C07B"> List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Range</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt;</span><span style="color:#61AFEF"> merge</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt; </span><span style="color:#E06C75;font-style:italic">values</span><span style="color:#ABB2BF">, </span><span style="color:#C678DD">double</span><span style="color:#E06C75;font-style:italic"> factor</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (values </span><span style="color:#56B6C2">==</span><span style="color:#D19A66"> null</span><span style="color:#56B6C2"> ||</span><span style="color:#E5C07B"> values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">size</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">&lt;</span><span style="color:#D19A66"> 3</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD">            return</span><span style="color:#E5C07B"> List</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">of</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">        var</span><span style="color:#E06C75"> median</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> calcMedian</span><span style="color:#ABB2BF">(values); </span><span style="color:#7F848E;font-style:italic">// 算中位数</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">//        System.out.printf(&quot;中位数 %f\n&quot;, median);</span></span>
<span class="line"><span style="color:#C678DD">        var</span><span style="color:#E06C75"> sum</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">mapToDouble</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#C678DD">::</span><span style="color:#ABB2BF">value).</span><span style="color:#61AFEF">sum</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">        var</span><span style="color:#E06C75"> doubles</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">filter</span><span style="color:#ABB2BF">(item </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> item</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">value</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">&gt;</span><span style="color:#ABB2BF"> median) </span><span style="color:#7F848E;font-style:italic">// 筛选大于中位数的值（等于的也不要，只要大于的）</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(it </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> it</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">value</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">distinct</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">sorted</span><span style="color:#ABB2BF">((o1, o2) </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> Double</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">compare</span><span style="color:#ABB2BF">(o2, o1)) </span><span style="color:#7F848E;font-style:italic">// 倒序排序</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">toList</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt; </span><span style="color:#E06C75">stage</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(it </span><span style="color:#C678DD">-&gt;</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">Item</span><span style="color:#56B6C2">&lt;</span><span style="color:#ABB2BF">E</span><span style="color:#56B6C2">&gt;</span><span style="color:#ABB2BF">) it).</span><span style="color:#61AFEF">toList</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">        for</span><span style="color:#ABB2BF"> (</span><span style="color:#C678DD">var</span><span style="color:#E06C75"> it</span><span style="color:#C678DD"> :</span><span style="color:#ABB2BF"> doubles) {</span></span>
<span class="line"><span style="color:#ABB2BF">            stage </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> mergeStage</span><span style="color:#ABB2BF">(stage, it);</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#E5C07B"> stage</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">filter</span><span style="color:#ABB2BF">(item </span><span style="color:#C678DD">-&gt;</span><span style="color:#ABB2BF"> item </span><span style="color:#C678DD">instanceof</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Range</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(it </span><span style="color:#C678DD">-&gt;</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Range</span><span style="color:#56B6C2">&lt;</span><span style="color:#ABB2BF">E</span><span style="color:#56B6C2">&gt;</span><span style="color:#ABB2BF">) it)</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">filter</span><span style="color:#ABB2BF">(it </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> it</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">sum</span><span style="color:#56B6C2"> &gt;</span><span style="color:#ABB2BF"> sum </span><span style="color:#56B6C2">*</span><span style="color:#ABB2BF"> factor) </span><span style="color:#7F848E;font-style:italic">// 筛选出占比超过 20% 的区间</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">sorted</span><span style="color:#ABB2BF">((o1, o2) </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> Double</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">compare</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">o2</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">sum</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">o1</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">sum</span><span style="color:#ABB2BF">))</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">limit</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">toList</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> static</span><span style="color:#ABB2BF"> &lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#E5C07B"> List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt;</span><span style="color:#61AFEF"> mergeStage</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt; </span><span style="color:#E06C75;font-style:italic">items</span><span style="color:#ABB2BF">, </span><span style="color:#C678DD">double</span><span style="color:#E06C75;font-style:italic"> value</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        // 把值大于或等于 value 的变成 Range</span></span>
<span class="line"><span style="color:#E5C07B">        List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt; </span><span style="color:#E06C75">ranged</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> items</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(it </span><span style="color:#C678DD">-&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">                    if</span><span style="color:#ABB2BF"> (it </span><span style="color:#C678DD">instanceof</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#56B6C2">&lt;</span><span style="color:#ABB2BF">E</span><span style="color:#56B6C2">&gt;</span><span style="color:#ABB2BF"> iv) {</span></span>
<span class="line"><span style="color:#C678DD">                        if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">iv</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">value</span><span style="color:#56B6C2"> &gt;=</span><span style="color:#ABB2BF"> value) {</span></span>
<span class="line"><span style="color:#C678DD">                            var</span><span style="color:#E06C75"> list</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> LinkedList</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt;();</span></span>
<span class="line"><span style="color:#E5C07B">                            list</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">add</span><span style="color:#ABB2BF">(iv);</span></span>
<span class="line"><span style="color:#C678DD">                            return</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Range</span><span style="color:#ABB2BF">&lt;&gt;(list, </span><span style="color:#E5C07B">iv</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">value</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">                        }</span></span>
<span class="line"><span style="color:#ABB2BF">                    }</span></span>
<span class="line"><span style="color:#C678DD">                    return</span><span style="color:#ABB2BF"> it;</span></span>
<span class="line"><span style="color:#ABB2BF">                })</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">toList</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt; </span><span style="color:#E06C75">result</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> ArrayList</span><span style="color:#ABB2BF">&lt;&gt;();</span></span>
<span class="line"><span style="color:#E5C07B">        result</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">add</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">ranged</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getFirst</span><span style="color:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">        for</span><span style="color:#ABB2BF"> (</span><span style="color:#C678DD">int</span><span style="color:#E06C75"> i</span><span style="color:#56B6C2"> =</span><span style="color:#D19A66"> 1</span><span style="color:#ABB2BF">; i </span><span style="color:#56B6C2">&lt;</span><span style="color:#E5C07B"> ranged</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">size</span><span style="color:#ABB2BF">(); i++) {</span></span>
<span class="line"><span style="color:#C678DD">            var</span><span style="color:#E06C75"> curr</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> ranged</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">get</span><span style="color:#ABB2BF">(i);</span></span>
<span class="line"><span style="color:#C678DD">            var</span><span style="color:#E06C75"> last</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> result</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getLast</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">            if</span><span style="color:#ABB2BF"> (last </span><span style="color:#C678DD">instanceof</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Range</span><span style="color:#56B6C2">&lt;</span><span style="color:#ABB2BF">E</span><span style="color:#56B6C2">&gt;</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">LinkedList</span><span style="color:#56B6C2">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#56B6C2">&lt;</span><span style="color:#ABB2BF">E</span><span style="color:#56B6C2">&gt;&gt;</span><span style="color:#ABB2BF"> lastValues, </span><span style="color:#C678DD">double</span><span style="color:#ABB2BF"> lastSum)) {</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (curr </span><span style="color:#C678DD">instanceof</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Range</span><span style="color:#56B6C2">&lt;</span><span style="color:#ABB2BF">E</span><span style="color:#56B6C2">&gt;</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">LinkedList</span><span style="color:#56B6C2">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#56B6C2">&lt;</span><span style="color:#ABB2BF">E</span><span style="color:#56B6C2">&gt;&gt;</span><span style="color:#ABB2BF"> currValues, </span><span style="color:#C678DD">double</span><span style="color:#ABB2BF"> currSum)) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                    // 合并连续两个 range</span></span>
<span class="line"><span style="color:#C678DD">                    var</span><span style="color:#E06C75"> newValues</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> LinkedList</span><span style="color:#ABB2BF">&lt;&gt;(lastValues);</span></span>
<span class="line"><span style="color:#E5C07B">                    newValues</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addAll</span><span style="color:#ABB2BF">(currValues);</span></span>
<span class="line"><span style="color:#C678DD">                    var</span><span style="color:#E06C75"> newRange</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Range</span><span style="color:#ABB2BF">&lt;&gt;(newValues, lastSum </span><span style="color:#56B6C2">+</span><span style="color:#ABB2BF"> currSum);</span></span>
<span class="line"><span style="color:#E5C07B">                    result</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">removeLast</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">                    result</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">add</span><span style="color:#ABB2BF">(newRange);</span></span>
<span class="line"><span style="color:#ABB2BF">                } </span><span style="color:#C678DD">else</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">                    result</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">add</span><span style="color:#ABB2BF">(curr);</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF">            } </span><span style="color:#C678DD">else</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">                result</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">add</span><span style="color:#ABB2BF">(curr);</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#ABB2BF"> result;</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> Comparator</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#ABB2BF">&lt;</span><span style="color:#C678DD">?</span><span style="color:#ABB2BF">&gt;&gt;</span><span style="color:#E06C75"> VALUE_DESC </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> (o1</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> o2) </span><span style="color:#C678DD">-&gt;</span><span style="color:#E5C07B"> Double</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">compare</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">o2</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">value</span><span style="color:#ABB2BF">(), </span><span style="color:#E5C07B">o1</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">value</span><span style="color:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> static</span><span style="color:#ABB2BF"> &lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;</span><span style="color:#C678DD"> double</span><span style="color:#61AFEF"> calcMedian</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">List</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Item</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Value</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">E</span><span style="color:#ABB2BF">&gt;&gt; </span><span style="color:#E06C75;font-style:italic">values</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        var</span><span style="color:#E06C75"> sorted</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> values</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stream</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">sorted</span><span style="color:#ABB2BF">(VALUE_DESC).</span><span style="color:#61AFEF">toList</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">        var</span><span style="color:#E06C75"> size</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> sorted</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">size</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (size </span><span style="color:#56B6C2">%</span><span style="color:#D19A66"> 2</span><span style="color:#56B6C2"> ==</span><span style="color:#D19A66"> 0</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD">            return</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">sorted</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">get</span><span style="color:#ABB2BF">(size </span><span style="color:#56B6C2">/</span><span style="color:#D19A66"> 2</span><span style="color:#56B6C2"> -</span><span style="color:#D19A66"> 1</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">value</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">+</span><span style="color:#E5C07B"> sorted</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">get</span><span style="color:#ABB2BF">(size </span><span style="color:#56B6C2">/</span><span style="color:#D19A66"> 2</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">value</span><span style="color:#ABB2BF">()) </span><span style="color:#56B6C2">/</span><span style="color:#D19A66"> 2</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">        } </span><span style="color:#C678DD">else</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">            return</span><span style="color:#E5C07B"> sorted</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">get</span><span style="color:#ABB2BF">(size </span><span style="color:#56B6C2">/</span><span style="color:#D19A66"> 2</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">value</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre>  </div> <div class="max-lg:hidden border border-indigo-50 rounded-lg p-6 bg-white shadow"> <div class="sticky top-4">   <h1 class="mt-4 text-indigo-600 font-bold">本文目录</h1> <ol class="ml-3 mt-4 list-disc pl-4 text-indigo-700"> <li class="font-bold text-sm"> <a class="cursor-pointer hover:bg-indigo-100" href="#背景">背景</a> </li><li class="font-bold text-sm"> <a class="cursor-pointer hover:bg-indigo-100" href="#ai-版算法">AI 版算法</a> </li><li class="font-bold text-sm"> <a class="cursor-pointer hover:bg-indigo-100" href="#手算版算法">手算版算法</a> </li><li class="ml-4 text-sm"> <a class="cursor-pointer hover:bg-indigo-100" href="#思路">思路</a> </li><li class="ml-4 text-sm"> <a class="cursor-pointer hover:bg-indigo-100" href="#代码">代码</a> </li> </ol>  </div> </div> </div> </div> </body></html>