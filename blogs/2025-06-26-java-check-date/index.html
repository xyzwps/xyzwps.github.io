<!DOCTYPE html><html lang="zh-CN"> <head><link rel="canonical" href="/blogs/2025-06-26-java-check-date"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Java 中如何检查一个日期是否合法？</title><script>
  var _hmt = _hmt || [];
  (function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e5cd13f29c2fc3a6a3ca36ad30480374";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script><link href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.4/katex.min.css" rel="stylesheet"><link rel="stylesheet" href="/_astro/2024-08-27-dg-to-di.By4DU7xU.css"></head> <body class="bg-indigo-50 pb-6"> <div class="container mx-auto px-4 py-2 flex"> <a href="/" class="rounded-full bg-white py-2 px-6 select-none"><span class="font-bold">@xyzwps</span></a> </div> <div class="container mx-auto pt-4 px-4 sm:px-6 lg:px-8"> <nav class="flex" aria-label="Breadcrumb"> <ol class="inline-flex items-center space-x-1 md:space-x-3"> <li class="inline-flex items-center"> <a href="/" class="inline-flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors duration-200"> <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"> <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path> </svg>
主页
</a> </li> <li> <div class="flex items-center"> <svg class="w-6 h-6 text-indigo-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"> <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path> </svg> <a href="/blogs" class="ml-1 text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors duration-200 md:ml-2"> 文章列表 </a> </div> </li> </ol> </nav> </div> <div class="container mx-auto p-4 min-h-screen"> <div class="grid grid-cols-4 gap-4"> <div class="prose prose-slate prose-code:before:content-[''] prose-code:after:content-[''] prose-img:p-4 prose-img:shadow  bg-white max-w-none col-span-3 max-lg:col-span-4 border border-indigo-50 rounded-lg p-6 shadow"> <h1>Java 中如何检查一个日期是否合法？</h1> <div class="text-sm text-gray-400">2025-06-26</div>   <h2 id="背景">背景</h2>
<p>最近要写校验身份证号的代码。这个东西用 AI 都能帮我自动生成了。
但是 AI 生成的代码里没有检查出生日期部分的代码。如果不检查，仅对校验和做检查，
那么形如下面的“身份证号”就会通过检查：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>123456789012345677</span></span>
<span class="line"><span>123456202502305672</span></span></code></pre>
<p>这肯定是不行的。我得自己补一个出生日期检查。</p>
<h2 id="检查日期">检查日期</h2>
<p>检查日期的代码当然也是 AI 来写。核心逻辑如下：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">private</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> DateTimeFormatter</span><span style="color:#E06C75"> DF </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> DateTimeFormatter</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">ofPattern</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;yyyyMMdd&quot;</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> boolean</span><span style="color:#61AFEF"> checkDate</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">String</span><span style="color:#E06C75"> date) {</span></span>
<span class="line"><span style="color:#C678DD">    try</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B">        LocalDate</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">parse</span><span style="color:#ABB2BF">(date, DF);</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">    } </span><span style="color:#C678DD">catch</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">Exception</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75">}</span></span></code></pre>
<p>这段代码写完后，我们发现对于 <code>20250230</code> 这样的日期，居然检查不出来！</p>
<p>于是我在 jshell 里试验了一下：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>jshell&gt; import java.time.format.DateTimeFormatter</span></span>
<span class="line"><span></span></span>
<span class="line"><span>jshell&gt; var df = DateTimeFormatter.ofPattern(&quot;yyyyMMdd&quot;)</span></span>
<span class="line"><span>df ==&gt; Value(YearOfEra,4,19,EXCEEDS_PAD)Value(MonthOfYear,2)Value(DayOfMonth,2)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>jshell&gt; df.parse(&quot;20250230&quot;)</span></span>
<span class="line"><span>$3 ==&gt; {},ISO resolved to 2025-02-28</span></span>
<span class="line"><span></span></span>
<span class="line"><span>jshell&gt; df.parse(&quot;20250231&quot;)</span></span>
<span class="line"><span>$4 ==&gt; {},ISO resolved to 2025-02-28</span></span>
<span class="line"><span></span></span>
<span class="line"><span>jshell&gt; df.parse(&quot;20250232&quot;)</span></span>
<span class="line"><span>|  异常错误 java.time.format.DateTimeParseException：Text &#39;20250232&#39; could not be parsed: Invalid value for DayOfMonth (valid values 1 - 28/31): 32</span></span>
<span class="line"><span>|        at DateTimeFormatter.createError (DateTimeFormatter.java:2079)</span></span>
<span class="line"><span>|        at DateTimeFormatter.parse (DateTimeFormatter.java:1940)</span></span>
<span class="line"><span>|        at (#5:1)</span></span>
<span class="line"><span>|  原因: java.time.DateTimeException： Invalid value for DayOfMonth (valid values 1 - 28/31): 32</span></span></code></pre>
<p>可以看到，Java 解析日期偷了懒，没有判断闰年，甚至没有按大月小月做区分，
只是简单粗暴的设定了一个 31 日的上限，在 31 之内，它会“智能”调整日期到合适的值。
比如，把 <code>20250231</code> 调成了 <code>20250228</code>。</p>
<p>这就是前大语言模型时代的“人工”智能？</p>
<p>这套日期时间 API 是 Java 8 引入的，我测试使用的是 Java 21。显然，这特么是个 feature！！</p>
<h2 id="如何改进">如何改进？</h2>
<p>最朴素的想法，就是自己写一个：</p>
<ol>
<li>解析出年月日</li>
<li>对大月、小月、2月分别做处理</li>
<li>对闰年的2月份专门做处理</li>
</ol>
<p>可是这么一搞的话，代码就长了。写这么一大段代码肯定耽误下班。我们得换个写法。</p>
<p>下面就是新写法，不解释了，一看就懂：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#C678DD">private</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> final</span><span style="color:#E5C07B"> DateTimeFormatter</span><span style="color:#E06C75"> DF </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> DateTimeFormatter</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">ofPattern</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;yyyyMMdd&quot;</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> boolean</span><span style="color:#61AFEF"> checkDate</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">String</span><span style="color:#E06C75"> date) {</span></span>
<span class="line"><span style="color:#C678DD">    try</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#E5C07B"> LocalDate</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">parse</span><span style="color:#ABB2BF">(date, DF).</span><span style="color:#61AFEF">format</span><span style="color:#ABB2BF">(DF).</span><span style="color:#61AFEF">equals</span><span style="color:#ABB2BF">(date);</span></span>
<span class="line"><span style="color:#E06C75">    } </span><span style="color:#C678DD">catch</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">Exception</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75">}</span></span></code></pre>  </div> <div class="max-lg:hidden border border-indigo-50 rounded-lg p-6 bg-white shadow"> <div class="sticky top-4">   <h1 class="mt-4 text-indigo-600 font-bold">本文目录</h1> <ol class="ml-3 mt-4 list-disc pl-4 text-indigo-700"> <li class="font-bold text-sm"> <a class="cursor-pointer hover:bg-indigo-100" href="#背景">背景</a> </li><li class="font-bold text-sm"> <a class="cursor-pointer hover:bg-indigo-100" href="#检查日期">检查日期</a> </li><li class="font-bold text-sm"> <a class="cursor-pointer hover:bg-indigo-100" href="#如何改进">如何改进？</a> </li> </ol>  </div> </div> </div> </div> </body></html>