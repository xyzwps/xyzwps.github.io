---
layout: ./_BlogLayout.astro
title: G1
---

# 介绍

Garbage-First (G1)收集器是一个服务器风格的垃圾收集器，针对具有大内存、多处理器的机器。
从 OracleJDK7 update 4 之后就完全支持 G1 垃圾收集器了。
它试图以较高的概率满足垃圾收集暂停时间目标，同时在不需要配置的情况下实现高吞吐量。
G1 旨在利用当前的目标应用程序和环境，在延迟和吞吐量之间实现最佳平衡，这些目标应用程序和环境的特性包括:

- 堆的大小可以达到数十 GB 甚至更大，其中超过 50% 的 Java 堆被活数据占据。
- 对象分配和跨代提升的速率随时间变化很大。
- 堆中有大量碎片。
- 有可预测的暂停时间目标，不超过几百毫秒，避免长时间的垃圾收集暂停。

从 JDK 9 开始，G1 就是默认的收集器（见 [JEP 248](https://openjdk.org/jeps/248)）。

## 如何配置和使用 G1

可以用 `-XX:+UseG1GC` 选项显示指定使用它。

可以通过 `-XX:MaxGCPauseMillis` 设置最大暂停目标，默认值是 200，单位是毫秒。
注意，此值不是说 GC 的暂停时间一定是小于此值，而是说绝大部分情况下会小于此值。

一般来说，你再指定一下 `-Xmx`，剩下的就交给 JVM 就可以了，JVM 会根据当前环境自动选择合适的缺省值。
如果这些缺省值无法满足需求，可以查看 Oracle 提供的调优手册
[HotSpot Virtual Machine Garbage Collection Tuning Guide - 9 Garbage-First Garbage Collector](https://docs.oracle.com/en/java/javase/11/gctuning/garbage-first-g1-garbage-collector1.html)。
连接中是 Java 11 的手册，在使用使，请注意选择版本。

使用 G1 时，请不要设置年轻代的大小。

## 参考

对于 G1 的改进一直在进行，可以在 [JEP 列表中查看相关信息](https://openjdk.org/jeps/0)。

有一些关于 G1 的视频或文章可供参考：

- [Getting Started with the G1 Garbage Collector - Oracle](https://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/index.html)
- [Garbage-First Garbage Collector - Oracle](https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/g1_gc.html)
- [G1: from garbage collector to waste management consultant](https://blogs.oracle.com/java/post/g1-from-garbage-collector-to-waste-management-consultant)
- [G1GC最初的设计思路（上）](https://www.bilibili.com/video/BV15B4y1972U)
- [G1GC最初的设计思路（下）](https://www.bilibili.com/video/BV1n3411P78a/?share_source=copy_web&vd_source=e391a20134a420e1b92880962eb2f77c)