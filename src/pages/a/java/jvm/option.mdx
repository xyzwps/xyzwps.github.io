---
layout: ../_BlogLayout.astro
title: JVM 选项
---

## JVM 选项的用法

启动一个 Java 程序可以使用以下两种方式：

```
java [options] classname [args]
java [options] -jar filename [args]
```

其中 JVM 相关选项（*options*）直接跟在 `java` 命令之后。

## JVM 选项的分类

大体上分为三类：

### 标准选项

Java 虚拟机(JVM)的所有实现都保证支持标准选项。
它们用于常见的操作，例如检查 JRE 的版本
（`-version`）、设置类路径（`-cp`）、启用详细输出（`-verbose:[class|module|gc|jni]`）等等。

可以使用 `java -h` 查看这些选项。

### 非标准选项

非标准选项是特定于 Java HotSpot 虚拟机的通用选项，因此不能保证所有 JVM 实现都支持它们，并且可能发生更改。
这些选项以 `-X` 开头。

比如常见的 `-Xms`、`-Xmx`、`-Xlog:<opts>` 等等。

### 高级选项

不推荐随意使用高级选项。这些是用于调优 Java HotSpot 虚拟机操作的特定区域的开发人员选项，
这些区域通常具有特定的系统需求，并且可能需要对系统配置参数的特权访问。
它们也不能保证得到所有 JVM 实现的支持，并且会受到更改的影响。高级选项以 `-XX` 开头。

每个 Java 新版本都可能会增加或者废弃/移除一些选项，[可以在这里查看这些选项的适用版本](https://chriswhocodes.com/vm-options-explorer.html)。
[也可以在这里查看](https://foojay.io/command-line-arguments/openjdk-16/?tab=alloptions)。每个
也可以使用 `-XX:+PrintFlagsFinal` 查看当前版本 `-XX` 选项，比如执行 `java -XX:+PrintFlagsFinal -version`。

布尔选项用于启用默认禁用的特性，或者禁用默认启用的特性。
这样的选项不需要参数。使用加号(`-XX:+OptionName`)启用布尔选项，使用减号(`-XX:-OptionName`)禁用。

对于需要参数的选项，参数可以用空格、冒号(:)或等号(=)与选项名分开，
或者参数可以直接跟在选项后面(每个选项的确切语法不同)。
如果需要以字节为单位指定大小，则可以不使用后缀，或者使用后缀 k 或 K 表示 KB ，m 或 M 表示 MB，
g 或 G 表示千 GB。例如，要将大小设置为8GB，可以指定8g、8192m、8388608k 或8589934592作为参数。
如果需要指定百分比，请使用0到1之间的数字(例如，为25% 指定0.25)。

## 常见的重要选项

### 指定堆内存大小

- `-Xms` 指定堆初始大小
- `-Xmx` 指定堆最大大小
- `-Xmn` 指定新生代/年轻代大小（G1不推荐设置）

比如 `-Xms2G -Xmx5G` 指定堆初始大小是 2GB，最大大小是 5GB。

[可以在此查看更多相关参数](https://docs.oracle.com/en/java/javase/20/gctuning/factors-affecting-garbage-collection-performance.html)。

### 指定使用的 GC 算法

```
-XX:+UseSerialGC
-XX:+UseParallelGC
-XX:+UseG1GC
-XX:+UseZGC
```

这里插一嘴，在 Java 14 中，已经移除了 CMS 收集器，见
[JEP 363: Remove the Concurrent Mark Sweep (CMS) Garbage Collector](https://openjdk.org/jeps/363)。

### 输出日志

JVM 的日志输出方式已经被统一，现在可以使用单一选项 `-Xlog:<opts>` 来决定输出哪些日志。
可以使用 `-Xlog:help` 查看帮助，可输出的东西相当多。

相关背景见 [JEP 158: Unified JVM Logging](https://openjdk.org/jeps/158) 和
[JEP 271: Unified GC Logging](https://openjdk.org/jeps/271)。

## 参考

- [java 命令](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html)
- [VM Options Explorer - OpenJDK11 HotSpot](https://chriswhocodes.com/vm-options-explorer.html)
- [Java - Print list of all -XX JVM options](https://www.logicbig.com/how-to/java-command/jvm-option-list.html)
- [Guide to the Most Important JVM Parameters | Baeldung](https://www.baeldung.com/jvm-parameters)