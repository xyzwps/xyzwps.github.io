---
layout: ./BlogLayout.astro
title: è®°ä¸€ä¸ª JS return await é—®é¢˜
date: 2022-06-23
---


æœ€å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ç»å¸¸ä¼šå†™ `return await` è¿™æ ·çš„ä»£ç ï¼Œæ¯”å¦‚:

```js
async function foo() {
    return await bar();
}
```

åæ¥æŸä¸€å¤©ï¼Œ eslint æç¤ºè¿™é‡Œçš„ `await` å¯ä»¥çœç•¥æ‰ï¼Œä¾æ®çš„æ˜¯è§„åˆ™ [no-return-await](https://eslint.org/docs/rules/no-return-await)ã€‚æˆ‘ä¹Ÿæ²¡çœ‹è¿™ä¸ªè§„åˆ™çš„è¯¦ç»†æè¿°ï¼Œæƒ³äº†æƒ³è¿™ä¹ˆåšç¡®å®æ˜¯å¯¹çš„ï¼Œç¡®å®èƒ½çœä¸‹ä¸€äº› CPU å¼€é”€ã€‚å­¦äº†ä¸€æ‰‹ã€‚

å‰å‡ å¤©ï¼Œæˆ‘å†™äº†ä¸€æ®µä¸‹é¢é‚£æ ·çš„ä»£ç ï¼Œæ„æ€æ˜¯å°è¯•æ‰§è¡Œ `doSomething` 3 æ¬¡ï¼Œå¦‚æœæœ‰ä¸€æ¬¡æˆåŠŸå°±è¿”å›ï¼Œå¦‚æœéƒ½å¤±è´¥åˆ™æŠ›å‡ºæœ€åä¸€ä¸ªé”™è¯¯ï¼š

```js
async function doSomething() {
  throw new Error('xxx');
}

async function doTry() {
  for (let i = 1; i <= 3; i++) {
    try {
      return doSomething();
    } catch (err) {
      if (i >= 3) throw err;
      else console.log('å°è¯•å¤±è´¥');
    }
  }
}

doTry()
  .then(() => process.exit(0))
  .catch((err) => {
    console.log('ç„¯');
    process.exit(1);
  });
```

ç»“æœåªè¾“å‡ºäº†ä¸€ä¸ªâ€œç„¯â€ã€‚

ç„¯ã€‚

åæ¥æƒ³äº†æƒ³ï¼Œè¿™æ®µä»£ç ç¡®å®æ˜¯å†™å¾—ä¸å¯¹ã€‚`return doSomething()` è¿™ä¸€å¥ç›´æ¥è¿”å›æ¥äº†ä¸€ä¸ªåŒ…ç€é”™è¯¯çš„ `Promise`ï¼Œæ‰€ä»¥å¤–é¢çš„ `try` å½“ç„¶æ˜¯å•¥éƒ½æ­˜ä¸åˆ°ã€‚åªè¦æ”¹æˆ `return await doSomething()`ï¼Œå°±å¯ä»¥æ­£å¸¸é‡è¯•äº†ã€‚

æå®šä¹‹åï¼Œæˆ‘å›å¤´çœ‹äº†çœ‹è§„åˆ™ [no-return-await](https://eslint.org/docs/rules/no-return-await) çš„æè¿°ï¼Œå‘ç°äººå®¶å·²ç»é¢„æ–™åˆ°è¿™ç§æƒ…å†µäº†ã€‚ğŸ˜‚

