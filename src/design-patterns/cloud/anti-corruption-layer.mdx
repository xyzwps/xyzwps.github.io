---
title: Anti-corruption Layer pattern
translateFrom: https://docs.microsoft.com/en-us/azure/architecture/patterns/anti-corruption-layer
---

在不共享相同语义的不同子系统之间实现外观（facade）或适配器层。
这一层将一个子系统发出的请求转换为另一个子系统。
使用此模式可确保应用程序的设计不受对外部子系统的依赖限制。
这种模式最早是由埃里克•埃文斯在领域驱动设计中描述的。

# 问题背景

大多数应用程序依赖于其他系统获得某些数据或功能。
例如，当遗留应用程序迁移到现代系统时，它可能仍然需要现有的遗留资源。
新特性必须能够调用遗留系统。对于逐步迁移来说尤其如此，随着时间的推移，
大型应用程序的不同特性被转移到现代系统中。

这些遗留系统通常会遇到质量问题，比如错综复杂的数据模式或过时的 API。
遗留系统中使用的特性和技术可能与更现代的系统有很大的不同。
要与遗留系统进行互操作，新应用程序可能需要支持过时的基础设施、协议、数据模型、
API 或其他一些您不希望放入现代应用程序中的特性。

维护新系统和遗留系统之间的访问可以迫使新系统至少遵循一些遗留系统的 API 或其他语义。
当这些遗留特性存在质量问题时，对它们的支持会“破坏”原本设计干净的现代应用程序。

类似的问题可能出现在任何您的开发团队不能控制的外部系统上，而不仅仅是遗留系统。

# 解决方案

通过在不同的子系统之间放置一个反腐败层来隔离它们。
这一层转换两个系统之间的通信，它使一个系统保持不变，
这样一来，另一个系统就可以避免损害自己设计和技术路径。

![防腐层](/asset/img/anti-corruption-layer.png)

上图显示了一个具有两个子系统的应用程序。
子系统 A 通过反腐败层调用子系统 B。
子系统 A 与反腐败层之间的通信通常使用子系统 A 的数据模型和体系结构，
从反腐败层对子系统 B 的调用符合该子系统的数据模型或方法。
反腐败层包含在两个系统之间进行转换所需的所有逻辑。该层可以作为应用程序内的组件或独立服务实现。

# 问题与注意事项

* 反腐败层可能会给两个系统之间的调用增加延迟。
* 反腐败层添加了一个必须管理和维护的附加服务。
* 考虑一下您的反腐败层将如何扩大规模。
* 考虑是否需要多个反腐败层。您可能希望使用不同的技术或语言将功能分解为多个服务，
  或者可能有其他原因要对反腐败层进行分区。
* 考虑如何管理与其他应用程序或服务相关的反腐败层。它将如何集成到您的监视、发布和配置过程中？
* 确保事务和数据的一致性得到维护，并且可以进行监视。
* 考虑反腐败层是否需要处理不同子系统之间的所有通信，或者仅仅是一个特性子集。
* 如果反腐败层是应用程序迁移策略的一部分，请考虑它是永久性的，还是在迁移了所有遗留功能之后退役。

# 何时使用

以下情况可以使用此模式：

* 迁移计划分多个阶段进行，但是需要维护新系统和遗留系统之间的集成。
* 两个或多个子系统具有不同的语义，但仍然需要进行通信。

如果新系统和遗留系统之间没有显著的语义差异，则此模式可能不适合。