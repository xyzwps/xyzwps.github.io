---
layout: ../../../layouts/MdxLayout.astro
title: Gatekeeper pattern
parent:
  name: 返回上级
  path: /cheatsheet/cloud-patterns/
translateFrom:
  url: https://learn.microsoft.com/en-us/azure/architecture/patterns/gatekeeper
  title: Gatekeeper pattern - Azure Architecture Center
---

TODO: 翻译很奇怪

通过使用专用主机实例在客户端和应用程序或服务之间代理请求来保护应用程序和服务。
代理验证和清理请求，并可以提供额外的安全层并限制系统的攻击面。

## 问题上下文

云服务公开允许客户端应用程序调用其API的端点，用于实现API的代码触发或执行若干任务，
包括但不限于身份验证、授权、参数校验以及部分或全部请求处理。
API代码很可能代表客户端访问存储和其他服务。

如果恶意用户破坏系统并获得对应用程序托管环境的访问权限，其安全机制以及对数据和其他服务的访问就会暴露。
因此，恶意用户可以不受限制地访问凭据、存储密钥、敏感信息和其他服务。

## 解决方案

这个问题的一个解决方案是将实现公共端点的代码与处理请求和访问存储的代码分离。
您可以通过使用外观或与客户端交互的专用任务来实现解耦，然后将请求——也许通过解耦接口——给处理请求的主机或任务。
该图提供了这种模式的高级概述。

![](https://learn.microsoft.com/en-us/azure/architecture/patterns/_images/gatekeeper-diagram.png)

网守模式可以用来保护存储，也可以用作更全面的外观来保护应用程序的所有功能。重要因素是：

- **受控验证**。看门人验证所有请求，并拒绝不符合验证要求的请求。

- 有限的风险和暴露。看门人无权访问受信任主机用于访问存储和服务的凭据或密钥。如果看门人受到威胁，攻击者将无法访问这些凭据或密钥。

- 适当的安全性。网守以有限权限模式运行，而应用程序的其余部分以访问存储和服务所需的完全信任模式运行。
  如果网守受到威胁，它就不能直接访问应用程序服务或数据。

这种模式就像典型网络拓扑中的防火墙。它允许网守检查请求，并决定是否将请求传递给执行所需任务的受信任主机。
此决定通常要求网守在将请求内容传递给受信任主机之前验证和清理请求内容。

## 实现考量

在决定如何实现此模式时，请考虑以下几点：

- 确保受信任的主机仅公开内部或受保护的端点，仅由网守使用。受信任的主机不应公开任何外部端点或接口。
- 网守必须在有限权限模式下运行，这通常需要在单独的托管服务或虚拟机中运行网守和受信任的主机。
- 网守不应该执行与应用程序或服务相关的任何处理或访问任何数据。它的功能纯粹是验证和清理请求。受信任的主机可能需要执行额外的请求验证，但网守应该执行核心验证。
- 尽可能在网守与受信任的主机或任务之间使用安全通信通道（HTTPS、SSL或TLS）。但是，某些托管环境不支持内部端点上的HTTPS。
- 由于需要额外的处理和网络通信，添加额外的层来实现网守模式可能会影响性能。
- 网守实例可能是单点故障。为了最大限度地减少故障的影响，请考虑部署冗余实例并使用自动缩放机制来确保保持可用性的能力。

## 何时使用

此模式有助于以下应用程序：

- 处理敏感信息
- 暴露需要高度保护免受恶意攻击的服务
- 执行不能中断的关键任务操作。
- 要求请求验证与主要任务分开执行，或集中此验证以简化维护和管理